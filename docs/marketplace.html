<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SoneVibe | NFT Marketplace</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/svg+xml" href="icons/vibe.svg">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <style>
      /* --- PRO STYLES V4 --- */
      .toolbar { display: flex; gap: 15px; margin-bottom: 20px; align-items: center; flex-wrap: wrap; }
      
      .filter-select { background: #1a1f35; border: 1px solid rgba(255,255,255,0.1); color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer; outline: none; font-family: 'Inter', sans-serif; min-width: 200px; }
      .filter-select:hover { border-color: var(--primary); }

      .tab-group { display: flex; gap: 5px; background: rgba(0,0,0,0.2); padding: 5px; border-radius: 10px; }
      .tab-btn { background: transparent; border: none; color: #888; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.3s; }
      .tab-btn:hover { color: white; }
      .tab-btn.active { background: var(--primary, #5865F2); color: white; }
      
      .nft-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; margin-top: 20px; min-height: 300px; }
      
      .nft-card { 
          position: relative; overflow: hidden; 
          transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.05); 
          display: flex; flex-direction: column;
          background: rgba(255, 255, 255, 0.02);
      }
      .nft-card:hover { transform: translateY(-5px); border-color: var(--primary, #5865F2); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
      
      .badge { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; color: #FF00FF; border: 1px solid #FF00FF; z-index: 2; backdrop-filter: blur(4px); }
      
      /* Data Source Indicator */
      .source-indicator { font-size: 0.75rem; color: #666; margin-left: auto; display: flex; align-items: center; gap: 5px; }
      .source-dot { width: 8px; height: 8px; border-radius: 50%; background: #666; }
      .source-active.graph { color: #8b5cf6; } 
      .source-active.graph .source-dot { background: #8b5cf6; box-shadow: 0 0 10px #8b5cf6; }
      .source-active.rpc { color: #f59e0b; } 
      .source-active.rpc .source-dot { background: #f59e0b; }

      /* Modals */
      .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
      .modal-overlay.open { display: flex; }
      
      .action-modal { background: #1a1f35; width: 400px; padding: 30px; border-radius: 16px; border: 1px solid var(--primary); box-shadow: 0 0 50px rgba(88, 101, 242, 0.2); position: relative; animation: slideUp 0.3s ease; }
      
      /* Wallet Modal Specifics (Heredado de markets.html) */
      .modal-card { background: #1a1f35; width: 400px; border-radius: 16px; padding: 24px; border: 1px solid rgba(255,255,255,0.1); position: relative; animation: slideUp 0.3s ease; }
      .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
      .modal-title { margin: 0; font-size: 1.25rem; font-weight: 600; }
      .btn-close { background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1; }
      .btn-close:hover { color: white; }
      .wallet-grid { display: grid; gap: 12px; }
      .wallet-btn { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.03); padding: 12px 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: all 0.2s; }
      .wallet-btn:hover { background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.1); transform: translateX(2px); }
      .wallet-info { display: flex; align-items: center; gap: 12px; font-weight: 500; }
      .wallet-badge { background: rgba(88, 101, 242, 0.2); color: #5865F2; padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; }

      .input-group { margin: 20px 0; }
      .input-group label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.9rem; }
      .input-std { width: 100%; background: #0f1220; border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
      .input-std:focus { border-color: var(--primary); outline: none; }
      
      #toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
      .toast { background: #1a1f35; border-left: 4px solid var(--primary); padding: 15px 20px; border-radius: 4px; color: white; box-shadow: 0 5px 20px rgba(0,0,0,0.5); animation: slideIn 0.3s ease; min-width: 250px; font-size: 0.9rem; }
      .toast.error { border-left-color: #f87171; }
      .toast.success { border-left-color: #4ade80; }
      
      @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
      @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body>

  <div class="app-container">
    <nav class="sidebar glass-panel">
      <div class="logo-area">
        <svg width="28" height="28" viewBox="0 0 64 64"><circle cx="32" cy="32" r="32" fill="#1a1f35"/><path d="M18 42 L32 18 L46 42 Z" fill="#00e0ff"/></svg>
        SoneVibe
      </div>
      <a href="index.html" class="nav-link">Dashboard</a>
      <a href="dashboard.html" class="nav-link">Lend/Borrow</a>
      <a href="markets.html" class="nav-link">Markets</a>
      <a href="swap.html" class="nav-link">Swap</a>
      <a href="marketplace.html" class="nav-link active" style="color: #FF00FF;">NFT Market V3</a>
    
      <a href="mint-svusd.html" class="nav-link">Mint SVUSDC</a>
      <a href="swapstabilizer.html" class="nav-link">Stabilizer SVUSDC</a>
      <a href="vibe-vault.html" class="nav-link">Governance Vault</a>
      <a href="liquidator.html" class="nav-link" style="color:var(--danger);">Liquidator Console</a>
      <a href="souschefv2.html" class="nav-link">Sous Chef Pools Preview</a>
      
      <div style="flex-grow:1"></div>
      <div style="padding: 10px; font-size: 0.8rem; color: var(--text-muted);">
        Network Status:<br>
        <span id="statusDot" style="color: var(--warning)">‚óè</span> <span id="connStatus">Syncing...</span>
      </div>
    </nav>

    <div class="main-content">
      
      <header>
        <div>
          <h1 style="margin:0; font-size:1.8rem;">SoneVibe Marketplace</h1>
          <p style="margin:4px 0 0 0; color:var(--text-muted);">Trade Yoki Origins & Collections on Soneium L2</p>
        </div>
        
        <div class="nav-group">
          <select id="networkSelect" class="network-select">
             <option value="" disabled selected>Init Network...</option>
          </select>
          <div class="btn-account-wrapper">
             <button id="btnConnect" class="btn-primary">Connect Wallet</button>
             <div id="accountDropdown" class="account-dropdown">
                 <div style="padding:12px 12px 6px 12px; font-size:0.8rem; color:var(--text-muted); text-transform:uppercase;">Connected Wallet</div>
                 <div style="padding:0 12px 12px 12px; font-size:1.1rem; font-weight:600; color:#fff;" id="dropdownAddress">0x00...000</div>
                 <div class="menu-divider"></div>
                 <div class="menu-item" id="btnCopyAddress"><span>üìã</span> Copy Address</div>
                 <div class="menu-item" id="btnViewExplorer"><span>üîç</span> View on Explorer</div>
                 <div class="menu-divider"></div>
                 <div class="menu-item" id="btnDisconnect" style="color:var(--danger);"><span>üö™</span> Disconnect</div>
             </div>
          </div>
        </div>
      </header>

      <div class="toolbar glass-panel">
          <select id="collectionSelect" class="filter-select">
             <option>Loading Collections...</option>
          </select>
          
          <div class="tab-group">
              <button class="tab-btn active" onclick="window.switchTab('market')">Market</button>
              <button class="tab-btn" onclick="window.switchTab('selling')">My Listings</button>
              <button class="tab-btn" onclick="window.switchTab('wallet')">List Item</button>
          </div>
          
          <div id="dataSourceDisplay" class="source-indicator">
              <div class="source-dot"></div> <span id="sourceText">Initializing</span>
          </div>
      </div>

      <div id="view-market">
        <div class="glass-panel">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="margin-top:0;">Live Listings</h2>
                <button class="btn-primary" style="padding: 5px 15px; font-size:0.8rem;" onclick="window.refreshMarketData()">‚Üª Refresh</button>
            </div>
            <div id="marketGrid" class="nft-grid">
                <div style="text-align:center; grid-column:1/-1; color:#888;">Connect wallet or select network to view.</div>
            </div>
        </div>
      </div>

      <div id="view-selling" style="display:none;">
        <div class="glass-panel">
            <h2 style="margin-top:0;">Your Active Listings</h2>
            <p style="color:var(--text-muted)">Manage or cancel your current sales.</p>
            <div id="myListingsGrid" class="nft-grid">
                <div style="text-align:center; grid-column:1/-1; color:#888;">Checking your wallet...</div>
            </div>
        </div>
      </div>

      <div id="view-wallet" style="display:none;">
        <div class="glass-panel">
            <h2 style="margin-top:0;">List Item</h2>
            <p style="color:var(--text-muted); margin-bottom:20px;">Enter the Token ID you own to list it.</p>
            
            <div style="display:flex; gap:10px; align-items:flex-end; max-width: 500px;">
                <div style="flex:1;">
                    <label style="color:#aaa; font-size:0.9rem; margin-bottom:5px; display:block;">Token ID</label>
                    <input type="number" id="sellIdInput" class="input-std" placeholder="e.g. 888">
                </div>
                 <div style="flex:1;">
                    <button class="btn-primary" style="height:44px; width:100%;" onclick="window.openSellModalManual()">Configure Listing</button>
                </div>
            </div>
            <div style="margin-top: 20px; font-size: 0.9rem; color: var(--warning);">
                Note: Ensure you own the NFT in the selected collection before listing.
            </div>
        </div>
      </div>

    </div> 
  </div>

  <div id="actionModal" class="modal-overlay">
    <div class="action-modal">
        <button class="btn-close" onclick="window.closeActionModal()" style="position:absolute; top:15px; right:15px; background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">√ó</button>
        <h2 id="modalTitle" style="margin-top:0;">Action</h2>
        <div id="modalContent"></div>
    </div>
  </div>

  <!-- Wallet Modal (Estandarizado con markets.html) -->
  <div id="walletModal" class="modal-overlay">
    <div class="modal-card">
      <div class="modal-header">
        <h2 class="modal-title">Connect Wallet</h2>
        <button class="btn-close" onclick="window.closeWalletModal()">√ó</button>
      </div>
      <div id="walletList" class="wallet-grid"></div>
      <div style="margin-top:24px; text-align:center; font-size:0.8rem; color:var(--text-muted);">
        By connecting, you agree to VIBE Terms of Service.
      </div>
    </div>
  </div>

  <div id="toast-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
  
  <script src="config.js"></script> 
  <script src="wallet-config.js"></script> 
  <script src="market-config.js"></script> 
  <script src="marketplace.js"></script>
</body>
</html>